import{k as E,r as p,t as S,s as v,j as e,m as _,S as R,M as C,q as L,A as q}from"./index-BwokqWUm.js";import{B as D}from"./BottomNav-B5kOPxuM.js";import{C as I,P as G}from"./ProfileCircle-dNBGVNsB.js";import{L as U}from"./TrackLineageView-Dm5VuJyW.js";import{S as M,a as A,b as B,c as T,d as z}from"./select-EhOPVDn7.js";import{C as V}from"./check-T5eEYh5j.js";import{K as P,R as $}from"./rotate-ccw-BOzLRPCB.js";import"./menu-DOhLMPUF.js";import"./search-B_zF9Xl2.js";import"./user-ocqv7jmx.js";import"./card-DFK4skjK.js";import"./badge-Bu_Wz6O5.js";import"./arrow-right-BvG7rpeg.js";import"./index-D6jvYMWB.js";function K(n,s){if(!n.progression_roman||!s.progression_roman)return 0;const i=n.progression_roman.map(m=>m.toLowerCase()),t=s.progression_roman.map(m=>m.toLowerCase()),l=i.filter(m=>t.includes(m)).length,c=new Set([...i,...t]).size,d=(m,w)=>{const b=[];for(let N=0;N<=m.length-w;N++)b.push(m.slice(N,N+w).join("-"));return b},o=d(i,2),x=d(t,2),u=o.filter(m=>x.includes(m)).length,g=Math.max(o.length,x.length)||1,f=l/c,h=u/g,j=1-Math.abs(i.length-t.length)*.1,a=n.detected_mode===s.detected_mode?.1:0,r=(f*.3+h*.5+a)*Math.max(.5,j);return Math.min(100,Math.round(r*100))}function Q(n,s){if(!n.progression_roman||!s.progression_roman)return"Unable to compare - missing chord data";const i=n.progression_roman,t=s.progression_roman,l=i.filter(d=>t.map(o=>o.toLowerCase()).includes(d.toLowerCase()));if(l.length===0)return"No shared chords, different harmonic language";const c=[];return l.length===i.length&&l.length===t.length?c.push("Identical chord vocabulary"):c.push(`${l.length} shared chord(s): ${l.join(", ")}`),n.detected_mode===s.detected_mode&&n.detected_mode?c.push(`Both in ${n.detected_mode}`):n.detected_mode&&s.detected_mode&&c.push(`Different modes (${n.detected_mode} vs ${s.detected_mode})`),n.cadence_type===s.cadence_type&&n.cadence_type!=="none"&&c.push(`Same ${n.cadence_type} cadence`),c.join(". ")}function re(){var y,j;const n=E(),[s,i]=p.useState(null),[t,l]=p.useState(null),c=p.useMemo(()=>new URLSearchParams(n.search),[n.search]),d=c.get("a")||void 0,o=c.get("b")||void 0,x=S(d,!!d),u=S(o,!!o);p.useEffect(()=>{if(!d)return;const a=v.find(r=>r.id===d)||null;if(a){i(a);return}x.data&&i(x.data)},[d,x.data]),p.useEffect(()=>{if(!o)return;const a=v.find(r=>r.id===o)||null;if(a){l(a);return}u.data&&l(u.data)},[o,u.data]);const g=s&&t?K(s,t):null,f=s&&t?Q(s,t):null,h=p.useMemo(()=>{const a=new Map;for(const r of v)a.set(r.id,r);return s&&a.set(s.id,s),t&&a.set(t.id,t),Array.from(a.values())},[s,t]);return e.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 glass-strong safe-top",children:e.jsxs("div",{className:"px-4 py-4 max-w-lg mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{size:22,className:"text-primary"}),e.jsx("h1",{className:"text-xl font-bold",children:"Compare"})]}),e.jsx(G,{})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compare the harmonic DNA of two songs"})]})}),e.jsxs("main",{className:"px-4 py-4 max-w-lg mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Track A"}),e.jsxs(M,{value:s==null?void 0:s.id,onValueChange:a=>i(h.find(r=>r.id===a)||null),children:[e.jsx(A,{className:"bg-muted/50",children:e.jsx(B,{placeholder:"Select track"})}),e.jsx(T,{children:h.map(a=>e.jsx(z,{value:a.id,children:e.jsx("span",{className:"truncate",children:a.title})},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Track B"}),e.jsxs(M,{value:t==null?void 0:t.id,onValueChange:a=>l(h.find(r=>r.id===a)||null),children:[e.jsx(A,{className:"bg-muted/50",children:e.jsx(B,{placeholder:"Select track"})}),e.jsx(T,{children:h.map(a=>e.jsx(z,{value:a.id,children:e.jsx("span",{className:"truncate",children:a.title})},a.id))})]})]})]}),s&&t&&e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsx("div",{className:"text-center py-6",children:e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-xl object-cover mb-2"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-20",children:s.title})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(_.div,{initial:{scale:.5},animate:{scale:1},className:"relative",children:[e.jsx("div",{className:"w-20 h-20 rounded-full glass-strong flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold gradient-text",children:[g,"%"]})}),g!==null&&g>=70&&e.jsx(_.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4 text-primary-foreground"})})]}),e.jsx("span",{className:"text-xs text-muted-foreground mt-2",children:"Similarity"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[t.cover_url&&e.jsx("img",{src:t.cover_url,alt:"",className:"w-16 h-16 rounded-xl object-cover mb-2"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-20",children:t.title})]})]})}),f&&e.jsxs("div",{className:"p-4 glass rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-primary",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-sm",children:"Analysis"})]}),e.jsx("p",{className:"text-sm text-foreground",children:f})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-sm",children:s.artist}),e.jsxs("div",{className:"p-3 glass rounded-xl space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.detected_key||"?"," ",s.detected_mode||""]})]}),s.cadence_type&&s.cadence_type!=="none"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx($,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:s.cadence_type})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsxs("span",{children:[((y=s.progression_roman)==null?void 0:y.length)||0," chords"]})]})]}),s.progression_roman&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.progression_roman.map((a,r)=>e.jsx(L,{chord:a,size:"sm"},r))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-sm",children:t.artist}),e.jsxs("div",{className:"p-3 glass rounded-xl space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.detected_key||"?"," ",t.detected_mode||""]})]}),t.cadence_type&&t.cadence_type!=="none"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx($,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:t.cadence_type})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsxs("span",{children:[((j=t.progression_roman)==null?void 0:j.length)||0," chords"]})]})]}),t.progression_roman&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.progression_roman.map((a,r)=>e.jsx(L,{chord:a,size:"sm"},r))})]})]}),s.id&&t.id&&e.jsx(U,{startId:s.id,endId:t.id})]}),(!s||!t)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-muted/50 mb-4",children:e.jsx(q,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:"Select two tracks to compare their harmonic structure"})]})]}),e.jsx(D,{})]})}export{re as default};
