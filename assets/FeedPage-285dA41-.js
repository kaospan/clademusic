import{j as e,m as v,a as D,u as A,r as n,B as d,X as W,b as G,C as K,d as V}from"./index-CHi7gcmI.js";import{T as $}from"./TrackCard-DmLZzf6o.js";import{u as q,S as O}from"./useTracks-CSP1T5bJ.js";import{B as E}from"./BottomNav-CYe4nhFV.js";import{A as M}from"./index-CZejzNGf.js";import{S as Q}from"./sparkles-Cfg8pmiE.js";import{U as Z}from"./TrackComments-C3VZA-Yy.js";import{u as ee,R as z}from"./useSpotifyUser-DcNIfLjR.js";import{C as se}from"./circle-alert-DvI8DRvv.js";import{L as te}from"./log-in-CD-tlQlg.js";import"./ChordBadge-FPXMyd8k.js";import"./rotate-ccw-BK1e8ai1.js";import"./avatar-BYPZY01o.js";import"./switch-B-PwN09Q.js";import"./index-C4Xsr2M0.js";import"./useFollowing-Cxm9gPeZ.js";import"./useMutation-BNy-XvQm.js";import"./label-DH3HpjR6.js";import"./users-Sby7lmgK.js";import"./map-pin-CZUHjK4j.js";import"./radio-Yp0kc32d.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-DKE23lU-.js";import"./check-CNinraKo.js";import"./twitter-dK-KjndH.js";import"./send-xJeXhBMV.js";import"./timeFormat-BXo_t6_Q.js";import"./music-2-D0d3NYKG.js";import"./CladeIcon-D2HSVxlN.js";import"./heart-Daeg0xRF.js";import"./waves-O5KKQIfc.js";import"./bookmark-SthQJJoC.js";import"./search-BXrQN3vZ.js";import"./seedTracks-B6rAh97_.js";import"./spotifySearchService-CdZUFPek.js";import"./menu-Bm5lFd4-.js";import"./textarea-DFXlmeYl.js";import"./badge-B7Xyqy0k.js";import"./index-D-97mC-e.js";import"./chevron-right-CO8XY9qH.js";import"./trash-2-xFb9pxN7.js";function ae(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(a=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${a*100}ms`}},a))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},a))})]})]})}function ie(){const{guestMode:a,user:b}=D(),g=A(),[x,N]=n.useState(()=>{const j=localStorage.getItem("clade_guest_banner_dismissed");if(!j)return!1;const S=parseInt(j,10),F=24*60*60*1e3;return Date.now()-S<F}),w=a&&!b&&!x,y=()=>{N(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},k=()=>{g("/auth")};return e.jsx(M,{children:w&&e.jsxs(v.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(Q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(d,{size:"sm",onClick:k,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:y,className:"text-muted-foreground hover:text-foreground",children:e.jsx(W,{className:"w-4 h-4"})})]})]})]})})}function Ke(){const{user:a,loading:b}=D(),g=A(),{data:x,isLoading:N,error:w}=q(50),{data:y=[],isLoading:k}=ee([],[],50),j=(x==null?void 0:x.tracks)??[],S=a?y:[],F=[...j,...S],o=(()=>{const s=new Set;return F.filter(t=>{const r=t.spotify_id||t.id;return!r||s.has(r)?!1:(s.add(r),!0)})})(),[i,C]=n.useState(0),[P,_]=n.useState(new Map),L=n.useRef(null),[B,T]=n.useState(!a),{openPlayer:R}=G();n.useEffect(()=>{a&&T(!1)},[a]);const U=s=>{var r;if(!a){T(!0);return}const t=(r=o[i])==null?void 0:r.id;t&&(_(l=>{const p=new Map(l),c=new Set(l.get(t)||[]);return c.has(s)?c.delete(s):c.add(s),p.set(t,c),p}),s==="skip"&&i<o.length-1&&C(l=>l+1))},u=n.useCallback(()=>{i<o.length-1&&C(s=>s+1)},[i,o.length]),h=n.useCallback(()=>{i>0&&C(s=>s-1)},[i]);if(n.useEffect(()=>{const s=t=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||(t.key==="ArrowDown"||t.key==="j"?u():(t.key==="ArrowUp"||t.key==="k")&&h())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[u,h]),n.useEffect(()=>{const s=L.current;if(!s)return;let t=0,r=0,l=0;const p=f=>{t=f.touches[0].clientY,r=f.touches[0].clientX,l=Date.now()},c=f=>{const X=f.changedTouches[0].clientY,Y=f.changedTouches[0].clientX,I=t-X,H=Math.abs(r-Y),J=Date.now()-l;Math.abs(I)>50&&Math.abs(I)>H&&J<500&&(I>0?u():h())};return s.addEventListener("touchstart",p,{passive:!0}),s.addEventListener("touchend",c,{passive:!0}),()=>{s.removeEventListener("touchstart",p),s.removeEventListener("touchend",c)}},[u,h]),b||N||k)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ae,{}),e.jsx(E,{})]});if(w)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(se,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(E,{})]});const m=o[i];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:L,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(z,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[i+1," / ",o.length]}),!a&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>g("/auth"),className:"gap-1.5",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]})]})})}),B&&!a&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Youâ€™re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",onClick:()=>g("/auth"),children:"Sign in"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>T(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(d,{variant:"outline",size:"icon",className:"glass",onClick:h,disabled:i===0,children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx(d,{variant:"outline",size:"icon",className:"glass",onClick:u,disabled:i===o.length-1,children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsx(z,{maxWidth:"full",className:"py-6",children:e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(M,{mode:"wait",children:m&&e.jsx(v.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx($,{track:m,isActive:!0,onInteraction:U,interactions:P.get(m.id)||new Set,onPipModeActivate:(s,t)=>{s&&R({canonicalTrackId:m.id,provider:"youtube",providerTrackId:s,autoplay:!0,context:"feed",title:t,artist:m.artist})}})},m.id)})})})}),o[i]&&e.jsx(O,{roomId:"global",maxVisible:3,scrollSpeed:4e3}),e.jsx(ie,{}),e.jsx(E,{})]})}export{Ke as default};
