import{j as e,m as L,a as $,u as U,r as x,B as h,X as q,b as O,d as Q,e as Z,C as ee,f as se}from"./index-Cj43IkwR.js";import{T as te}from"./TrackCard-XSNr2Ta4.js";import{S as ae}from"./ScrollingComments-CG7Zi2BO.js";import{B as A}from"./BottomNav-HEwcisqe.js";import{A as Y}from"./index-BKWreeI-.js";import{S as ie}from"./sparkles-CzrbldZC.js";import{U as ne}from"./TrackComments-DYDEgs3m.js";import{R}from"./ResponsiveLayout-BNct_7wm.js";import{u as re}from"./useLastFm-40yEfos5.js";import{C as oe,P as le}from"./ProfileCircle-Bivk-SQd.js";import{C as ce}from"./circle-alert-DV__k1e6.js";import{L as _}from"./log-in-1-xRM6rp.js";import"./ChordBadge-CaMCFsCa.js";import"./rotate-ccw-CY30z-s6.js";import"./switch-DjnX0cOX.js";import"./index-ClJT4zam.js";import"./useFollowing-DIuzlWRk.js";import"./label-DHZvHCut.js";import"./users-7zdj13aC.js";import"./map-pin-NSLGfS4B.js";import"./radio-DBCabEJw.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-C5geHwAG.js";import"./check-nJkv3-Hl.js";import"./twitter-u3Ir31Eo.js";import"./send-BS4gfgyt.js";import"./timeFormat-1gw3rh39.js";import"./user-BBRFcpYg.js";import"./music-2-BjVwSWdY.js";import"./heart-C7qOBQiK.js";import"./waves-BBVugbsq.js";import"./bookmark-DYEHkbU5.js";import"./search-cJcvLl8T.js";import"./menu-BOlDXwpf.js";import"./textarea-oHtZtJ8t.js";import"./badge-B1715_1D.js";import"./index-B6_lfByn.js";import"./chevron-right-hAiJGakV.js";import"./trash-2-DOynKCUP.js";function de(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(n=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${n*100}ms`}},n))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(n=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},n))})]})]})}function me(){const{guestMode:n,user:z}=$(),C=U(),[S,v]=x.useState(()=>{const F=localStorage.getItem("clade_guest_banner_dismissed");if(!F)return!1;const I=parseInt(F,10),E=24*60*60*1e3;return Date.now()-I<E}),b=n&&!z&&!S,N=()=>{v(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},T=()=>{C("/signup")};return e.jsx(Y,{children:b&&e.jsxs(L.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(ie,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(h,{size:"sm",onClick:T,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(h,{size:"sm",variant:"ghost",onClick:N,className:"text-muted-foreground hover:text-foreground",children:e.jsx(q,{className:"w-4 h-4"})})]})]})]})})}function Qe(){const{user:n,loading:z,guestMode:C,enterGuestMode:S}=$(),{data:v=[]}=re(200),b=U(),{data:N,isLoading:T,error:F}=O(50),{data:I=[],isLoading:E}=Q([],[],50),B=(N==null?void 0:N.tracks)??[],X=n?I:[],H=x.useMemo(()=>{var o,u,r,c;const s=d=>{var m;if(!d||d.length===0)return;const t=["extralarge","large","medium","small"];for(const g of t){const f=d.find(P=>P.size===g);if(f!=null&&f["#text"])return f["#text"]}return((m=d[0])==null?void 0:m["#text"])||void 0},a=new Set,i=[];for(let d=0;d<v.length;d++){const t=v[d],m=String((t==null?void 0:t.name)||"").trim(),g=String(((o=t==null?void 0:t.artist)==null?void 0:o.name)||((u=t==null?void 0:t.artist)==null?void 0:u["#text"])||"").trim();if(!m||!g)continue;const f=`${m.toLowerCase()}|${g.toLowerCase()}`;if(a.has(f))continue;a.add(f);const P=(r=t==null?void 0:t.date)!=null&&r.uts?Number(t.date.uts)*1e3:void 0;i.push({id:`lastfm:${g}-${m}-${P??d}`,title:m,artist:g,album:((c=t==null?void 0:t.album)==null?void 0:c["#text"])||void 0,cover_url:s(t==null?void 0:t.image)})}return i},[v]),p=(()=>{const s=new Set;return[...H,...B,...X].filter(i=>{var c;const o=(i.title||i.name||"").toLowerCase().trim(),u=(i.artist||((c=i.artists)==null?void 0:c[0])||"").toLowerCase().trim(),r=i.spotify_id||i.youtube_id||`${o}|${u}`||i.id;return!r||s.has(r)?!1:(s.add(r),!0)})})(),[l,M]=x.useState(0),[G,J]=x.useState(new Map),D=x.useRef(null),[W,w]=x.useState(!n),{openPlayer:K}=Z();x.useEffect(()=>{(n||C)&&w(!1)},[n,C]);const V=s=>{var i;if(!n){w(!0);return}const a=(i=p[l])==null?void 0:i.id;a&&(J(o=>{const u=new Map(o),r=new Set(o.get(a)||[]);return r.has(s)?r.delete(s):r.add(s),u.set(a,r),u}),s==="skip"&&l<p.length-1&&M(o=>o+1))},y=x.useCallback(()=>{l<p.length-1&&M(s=>s+1)},[l,p.length]),k=x.useCallback(()=>{l>0&&M(s=>s-1)},[l]);if(x.useEffect(()=>{const s=a=>{a.target instanceof HTMLInputElement||a.target instanceof HTMLTextAreaElement||(a.key==="ArrowDown"||a.key==="j"?y():(a.key==="ArrowUp"||a.key==="k")&&k())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[y,k]),x.useEffect(()=>{const s=D.current;if(!s)return;let a=0,i=0,o=0;const u=c=>{a=c.touches[0].clientY,i=c.touches[0].clientX,o=Date.now()},r=c=>{const d=c.changedTouches[0].clientY,t=c.changedTouches[0].clientX,m=a-d,g=Math.abs(i-t),f=Date.now()-o;Math.abs(m)>50&&Math.abs(m)>g&&f<500&&(m>0?y():k())};return s.addEventListener("touchstart",u,{passive:!0}),s.addEventListener("touchend",r,{passive:!0}),()=>{s.removeEventListener("touchstart",u),s.removeEventListener("touchend",r)}},[y,k]),z||T||E)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(de,{}),e.jsx(A,{})]});if(F)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(ce,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(A,{})]});const j=p[l];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:D,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(R,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{size:24,className:"text-primary"}),e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"})]}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[l+1," / ",p.length]}),!n&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>{S(),w(!1)},className:"gap-1.5",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Continue as guest"})]}),e.jsxs(h,{variant:"ghost",onClick:()=>b("/auth"),className:"gap-1.5",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]}),e.jsx(le,{})]})]})})}),W&&!n&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Youâ€™re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",onClick:()=>b("/auth"),children:"Sign in"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>w(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(h,{variant:"outline",size:"icon",className:"glass",onClick:k,disabled:l===0,children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx(h,{variant:"outline",size:"icon",className:"glass",onClick:y,disabled:l===p.length-1,children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsxs(R,{maxWidth:"full",className:"py-6",children:[!n&&e.jsx("div",{className:"mx-auto mb-4 max-w-lg lg:max-w-2xl rounded-lg border border-border/60 bg-background/70 px-4 py-3 shadow-md backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Continue as guest to browse using the latest Last.fm scrobbles. You can switch to your account anytime."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",variant:"secondary",onClick:()=>{S(),w(!1)},children:"Continue as guest"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>b("/auth"),children:"Sign in"})]})]})}),e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(Y,{mode:"wait",children:j&&e.jsx(L.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx(te,{track:j,isActive:!0,onInteraction:V,interactions:G.get(j.id)||new Set,onPipModeActivate:(s,a)=>{s&&K({canonicalTrackId:j.id,provider:"youtube",providerTrackId:s,autoplay:!0,context:"feed",title:a,artist:j.artist})}})},j.id)})})]})}),p[l]&&e.jsx(ae,{roomId:"global",maxVisible:3,scrollSpeed:4e3}),e.jsx(me,{}),e.jsx(A,{})]})}export{Qe as default};
