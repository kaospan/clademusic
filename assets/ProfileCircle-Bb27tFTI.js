import{a as i,o as f,q as l,w as b,x as y,u as x,r as h,j as n,t as o,V as g,W as v,Y as w}from"./index-B54yB6gt.js";import{U as j}from"./user-CwIjaHAX.js";function q(){const{user:e}=i();return f({queryKey:["profile",e==null?void 0:e.id],queryFn:async()=>{if(!e)return null;const{data:s,error:t}=await l.from("profiles").select("*").eq("id",e.id).single();if(t)throw t;return s},enabled:!!e})}function P(){const{user:e}=i();return f({queryKey:["user-providers",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:s,error:t}=await l.from("user_providers").select("*").eq("user_id",e.id).order("connected_at",{ascending:!1});if(t)throw t;return s},enabled:!!e})}function k(){const{user:e}=i(),s=b();return y({mutationFn:async t=>{if(!e)throw new Error("Not authenticated");const{data:r,error:a}=await l.from("profiles").update({preferred_provider:t}).eq("id",e.id).select().single();if(a)throw a;return r},onSuccess:()=>{s.invalidateQueries({queryKey:["profile"]})}})}const d={sm:"h-7 w-7 text-xs",md:"h-9 w-9 text-sm",lg:"h-11 w-11 text-base"};function U({className:e,size:s="md"}){const t=x(),{user:r}=i(),{data:a}=q(),m=h.useMemo(()=>{var u;const c=(r==null?void 0:r.email)||"";return c?(u=c[0])==null?void 0:u.toUpperCase():"U"},[r==null?void 0:r.email]),p=()=>{t(r?"/profile":"/auth")};return n.jsx("button",{type:"button",onClick:p,className:o("inline-flex items-center justify-center rounded-full border border-border/60 bg-background/60 hover:bg-background/80 transition",e),"aria-label":r?"Open profile":"Sign in",title:r?"Profile":"Sign in",children:r?n.jsxs(g,{className:o(d[s],"border border-border/60"),children:[n.jsx(v,{src:(a==null?void 0:a.avatar_url)||void 0}),n.jsx(w,{className:"bg-primary/15 text-primary font-semibold",children:m})]}):n.jsx("span",{className:o(d[s],"inline-flex items-center justify-center"),children:n.jsx(j,{className:"h-4 w-4"})})})}export{U as P,P as a,k as b,q as u};
