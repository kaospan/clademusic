const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ScrollingComments-DufDeJuK.js","assets/index-DbymZBjF.js","assets/index-BamJNftZ.css","assets/index-BPeGxMLd.js"])))=>i.map(i=>d[i]);
import{j as e,m as L,a as B,u as X,r as o,B as h,X as O,b as q,d as Q,e as Z,C as ee,f as se,_ as te}from"./index-DbymZBjF.js";import{T as ae}from"./TrackCard-BtfoAbTA.js";import{B as P}from"./BottomNav-DiAKAAOD.js";import{A as H}from"./index-BPeGxMLd.js";import{S as ie}from"./sparkles-DHukf_Gn.js";import{U as ne}from"./TrackComments-B3HE9wdO.js";import{R as U}from"./ResponsiveLayout-B0O77wOl.js";import{u as re}from"./useLastFm-8e4PUWaQ.js";import{C as oe,P as le}from"./ProfileCircle-RJ2XeGIL.js";import{C as ce}from"./circle-alert-C7dIqsZx.js";import{L as Y}from"./log-in-1Rurrx7A.js";import"./ChordBadge-Cvd6pYxo.js";import"./rotate-ccw-DDBdhdKb.js";import"./switch-DHFSv4ZE.js";import"./index-DEyyudyt.js";import"./useFollowing-DkbVr37T.js";import"./label-BZo4ZEeD.js";import"./users-VObej9lj.js";import"./map-pin-BjLB29Sq.js";import"./radio-CWUAeFWX.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-BUnNaPqm.js";import"./check-BAmhA-cs.js";import"./twitter-B8juAttE.js";import"./send-Ca_d2Vjb.js";import"./timeFormat-1gw3rh39.js";import"./user-BA4J5i__.js";import"./music-2-DIkEOWe3.js";import"./heart-CBJ0om38.js";import"./waves-DZCRmRij.js";import"./bookmark-BSS7AG6T.js";import"./search-DeVAwHB8.js";import"./menu-BazsPMXV.js";import"./textarea-CPYQSDZH.js";import"./badge-Bo0eVkEs.js";import"./index-D_nGzSnN.js";import"./chevron-right-CITe_3zP.js";import"./trash-2-CGNhD1sU.js";function de(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(i=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${i*100}ms`}},i))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(i=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},i))})]})]})}function me(){const{guestMode:i,user:z}=B(),C=X(),[S,v]=o.useState(()=>{const F=localStorage.getItem("clade_guest_banner_dismissed");if(!F)return!1;const I=parseInt(F,10),E=24*60*60*1e3;return Date.now()-I<E}),b=i&&!z&&!S,N=()=>{v(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},T=()=>{C("/signup")};return e.jsx(H,{children:b&&e.jsxs(L.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(ie,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(h,{size:"sm",onClick:T,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(h,{size:"sm",variant:"ghost",onClick:N,className:"text-muted-foreground hover:text-foreground",children:e.jsx(O,{className:"w-4 h-4"})})]})]})]})})}const ue=o.lazy(()=>te(()=>import("./ScrollingComments-DufDeJuK.js"),__vite__mapDeps([0,1,2,3])).then(i=>({default:i.ScrollingComments})));function Qe(){const{user:i,loading:z,guestMode:C,enterGuestMode:S}=B(),{data:v=[]}=re(200),b=X(),{data:N,isLoading:T,error:F}=q(50),{data:I=[],isLoading:E}=Q([],[],50),A=(N==null?void 0:N.tracks)??[],D=i?I:[],R=o.useMemo(()=>{var l,x,r,d;const s=m=>{var u;if(!m||m.length===0)return;const t=["extralarge","large","medium","small"];for(const g of t){const f=m.find(M=>M.size===g);if(f!=null&&f["#text"])return f["#text"]}return((u=m[0])==null?void 0:u["#text"])||void 0},a=new Set,n=[];for(let m=0;m<v.length;m++){const t=v[m],u=String((t==null?void 0:t.name)||"").trim(),g=String(((l=t==null?void 0:t.artist)==null?void 0:l.name)||((x=t==null?void 0:t.artist)==null?void 0:x["#text"])||"").trim();if(!u||!g)continue;const f=`${u.toLowerCase()}|${g.toLowerCase()}`;if(a.has(f))continue;a.add(f);const M=(r=t==null?void 0:t.date)!=null&&r.uts?Number(t.date.uts)*1e3:void 0;n.push({id:`lastfm:${g}-${u}-${M??m}`,title:u,artist:g,album:((d=t==null?void 0:t.album)==null?void 0:d["#text"])||void 0,cover_url:s(t==null?void 0:t.image)})}return n},[v]),p=o.useMemo(()=>{const s=new Set;return[...R,...A,...D].filter(n=>{var d;const l=(n.title||n.name||"").toLowerCase().trim(),x=(n.artist||((d=n.artists)==null?void 0:d[0])||"").toLowerCase().trim(),r=n.spotify_id||n.youtube_id||`${l}|${x}`||n.id;return!r||s.has(r)?!1:(s.add(r),!0)})},[R,A,D]),[c,_]=o.useState(0),[G,J]=o.useState(new Map),$=o.useRef(null),[V,w]=o.useState(!i),{openPlayer:W}=Z();o.useEffect(()=>{(i||C)&&w(!1)},[i,C]);const K=s=>{var n;if(!i){w(!0);return}const a=(n=p[c])==null?void 0:n.id;a&&(J(l=>{const x=new Map(l),r=new Set(l.get(a)||[]);return r.has(s)?r.delete(s):r.add(s),x.set(a,r),x}),s==="skip"&&c<p.length-1&&_(l=>l+1))},y=o.useCallback(()=>{c<p.length-1&&_(s=>s+1)},[c,p.length]),k=o.useCallback(()=>{c>0&&_(s=>s-1)},[c]);if(o.useEffect(()=>{const s=a=>{a.target instanceof HTMLInputElement||a.target instanceof HTMLTextAreaElement||(a.key==="ArrowDown"||a.key==="j"?y():(a.key==="ArrowUp"||a.key==="k")&&k())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[y,k]),o.useEffect(()=>{const s=$.current;if(!s)return;let a=0,n=0,l=0;const x=d=>{a=d.touches[0].clientY,n=d.touches[0].clientX,l=Date.now()},r=d=>{const m=d.changedTouches[0].clientY,t=d.changedTouches[0].clientX,u=a-m,g=Math.abs(n-t),f=Date.now()-l;Math.abs(u)>50&&Math.abs(u)>g&&f<500&&(u>0?y():k())};return s.addEventListener("touchstart",x,{passive:!0}),s.addEventListener("touchend",r,{passive:!0}),()=>{s.removeEventListener("touchstart",x),s.removeEventListener("touchend",r)}},[y,k]),z||T||E)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(de,{}),e.jsx(P,{})]});if(F)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(ce,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(P,{})]});const j=p[c];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:$,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(U,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{size:24,className:"text-primary"}),e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"})]}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[c+1," / ",p.length]}),!i&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>{S(),w(!1)},className:"gap-1.5",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Continue as guest"})]}),e.jsxs(h,{variant:"ghost",onClick:()=>b("/auth"),className:"gap-1.5",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]}),e.jsx(le,{})]})]})})}),V&&!i&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Youâ€™re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",onClick:()=>b("/auth"),children:"Sign in"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>w(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(h,{variant:"outline",size:"icon",className:"glass",onClick:k,disabled:c===0,children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx(h,{variant:"outline",size:"icon",className:"glass",onClick:y,disabled:c===p.length-1,children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsxs(U,{maxWidth:"full",className:"py-6",children:[!i&&e.jsx("div",{className:"mx-auto mb-4 max-w-lg lg:max-w-2xl rounded-lg border border-border/60 bg-background/70 px-4 py-3 shadow-md backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Continue as guest to browse using the latest Last.fm scrobbles. You can switch to your account anytime."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",variant:"secondary",onClick:()=>{S(),w(!1)},children:"Continue as guest"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>b("/auth"),children:"Sign in"})]})]})}),e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(H,{mode:"wait",children:j&&e.jsx(L.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx(ae,{track:j,isActive:!0,onInteraction:K,interactions:G.get(j.id)||new Set,onPipModeActivate:(s,a)=>{s&&W({canonicalTrackId:j.id,provider:"youtube",providerTrackId:s,autoplay:!0,context:"feed",title:a,artist:j.artist})}})},j.id)})})]})}),p[c]&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(ue,{roomId:"global",maxVisible:3,scrollSpeed:4e3})}),e.jsx(me,{}),e.jsx(P,{})]})}export{Qe as default};
