import{c as de,u as me,k as ue,a as he,l as xe,r as o,s as b,n as $,R as fe,o as pe,j as e,B as p,M as P,m as j,S as ge,X as B,p as ye,q as X,h as je,Q as H}from"./index-BwokqWUm.js";import{B as Ne}from"./BottomNav-B5kOPxuM.js";import{I as ve}from"./input-Culoeemx.js";import{B as N}from"./badge-Bu_Wz6O5.js";import{n as Z}from"./navigation-PB9wrqL7.js";import{R as K}from"./ResponsiveLayout-BqwJ1aPX.js";import{C as be,P as we}from"./ProfileCircle-dNBGVNsB.js";import{T as ee}from"./trending-up-CEtPYD-g.js";import{S as se}from"./search-B_zF9Xl2.js";import{A as Se}from"./index-DDWLPyMc.js";import{Z as te}from"./zap-Bp2FwyLY.js";import{H as ae}from"./heart-B5jS5Sbs.js";import{C as Ce}from"./clock-B3WgT66y.js";import{A as _e}from"./arrow-right-BvG7rpeg.js";import{E as Ie}from"./external-link-Bcn99mir.js";import"./menu-DOhLMPUF.js";import"./user-ocqv7jmx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=de("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),q="clade_search_history",Le=20;function L(){try{const n=localStorage.getItem(q);return n?JSON.parse(n).sort((u,x)=>x.timestamp-u.timestamp):[]}catch(n){return console.error("Error loading search history:",n),[]}}function ke(n){try{const h=L();if(h.slice(0,5).some(g=>g.query.toLowerCase()===n.query.toLowerCase()&&g.type===n.type))return;const r=[{...n,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()},...h].slice(0,Le);localStorage.setItem(q,JSON.stringify(r))}catch(h){console.error("Error saving search history:",h)}}function ze(n){try{const u=L().filter(x=>x.id!==n);localStorage.setItem(q,JSON.stringify(u))}catch(h){console.error("Error removing from search history:",h)}}function Je(){const n=me(),h=ue(),{user:u}=he(),{data:x}=xe(),[r,g]=o.useState(""),[c,k]=o.useState("song"),[y,z]=o.useState([]),[re,A]=o.useState(0),[Y,w]=o.useState(0),[ie,M]=o.useState([]),[S,E]=o.useState(!1),[D,W]=o.useState([]),[f,C]=o.useState([]),[d,F]=o.useState("all"),[m,R]=o.useState("all"),[O,le]=o.useState(!1);o.useEffect(()=>{W(L())},[]),o.useEffect(()=>{const s=new URLSearchParams(h.search),t=s.get("mode"),a=s.get("q");(t==="song"||t==="chord")&&k(i=>i===t?i:t),typeof a=="string"&&a.length>0&&g(i=>i===a?i:a)},[h.search]),o.useEffect(()=>{console.log("ðŸ” SearchPage mounted"),console.log("ðŸ“Š seedTracks count:",b.length),console.log("ðŸ“¦ First track:",b[0])},[]),o.useEffect(()=>{if(c!=="song"||!r.trim()||!u||!x){z([]),A(0),w(0);return}w(0);const s=setTimeout(async()=>{E(!0);try{const{tracks:t,total:a}=await $(u.id,r,50,0);z(t),A(a),w(t.length)}catch(t){console.error("Spotify search error:",t),z([]),A(0),w(0)}finally{E(!1)}},300);return()=>clearTimeout(s)},[r,c,u,x]);const oe=fe.useCallback(async()=>{if(u){E(!0);try{const{tracks:s,total:t}=await $(u.id,r,50,Y);z(a=>[...a,...s]),A(t),w(a=>a+s.length)}catch(s){console.error("Spotify load-more error:",s)}finally{E(!1)}}},[u,r,Y]);o.useEffect(()=>{let s=!1;if(c!=="song"||!r.trim()||x){M([]);return}const t=setTimeout(async()=>{try{const a=await pe(r,"");if(s)return;const i=a.map(l=>({id:`youtube:${l.videoId}`,title:l.title,artist:l.channel,youtube_id:l.videoId,provider:"youtube"}));M(i)}catch(a){console.error("YouTube search error:",a),M([])}},300);return()=>{s=!0,clearTimeout(t)}},[r,c,x]);const v=o.useMemo(()=>{let s=[];if(c==="song"){const t=r.toLowerCase();s=b.filter(a=>{var i,l,_,I,T;return!r.trim()||((i=a.title)==null?void 0:i.toLowerCase().includes(t))||((l=a.artist)==null?void 0:l.toLowerCase().includes(t))||((_=a.album)==null?void 0:_.toLowerCase().includes(t))||((I=a.genre)==null?void 0:I.toLowerCase().includes(t))||((T=a.genre_description)==null?void 0:T.toLowerCase().includes(t))})}else{const t=r.toUpperCase().split(/[-â€“â€”,\s]+/).map(a=>a.trim()).filter(Boolean);s=b.filter(a=>{if(!a.progression_roman)return!1;const i=a.progression_roman.map(l=>l.toUpperCase());return t.length===0||t.every(l=>i.includes(l)||i.includes(l.toLowerCase()))})}if(f.length>0&&(s=s.filter(t=>{const a=[t.genre,...t.genres||[]].filter(Boolean).map(i=>i==null?void 0:i.toLowerCase());return f.some(i=>a.some(l=>l==null?void 0:l.includes(i.toLowerCase())))})),d!=="all"&&(s=s.filter(t=>typeof t.energy!="number"?!1:d==="high"?t.energy>.7:d==="medium"?t.energy>=.4&&t.energy<=.7:d==="low"?t.energy<.4:!0)),m!=="all"&&(s=s.filter(t=>typeof t.valence!="number"?!1:m==="happy"?t.valence>.6:m==="sad"?t.valence<.4:m==="neutral"?t.valence>=.4&&t.valence<=.6:!0)),r.trim()&&c==="song"){const t=r.toLowerCase();return s.sort((a,i)=>{var Q,U,G,J;const l=((Q=a.title)==null?void 0:Q.toLowerCase())||"",_=((U=i.title)==null?void 0:U.toLowerCase())||"",I=((G=a.artist)==null?void 0:G.toLowerCase())||"",T=((J=i.artist)==null?void 0:J.toLowerCase())||"";return l.startsWith(t)&&!_.startsWith(t)?-1:!l.startsWith(t)&&_.startsWith(t)?1:I.startsWith(t)&&!T.startsWith(t)?-1:!I.startsWith(t)&&T.startsWith(t)?1:0})}return s},[r,c,f,d,m]),V=s=>{r.trim()&&(ke({query:r.trim(),type:c,track:c==="song"?s:void 0}),W(L()));const t=s.id||s.spotify_id||s.external_id;t&&Z(n,t)},ne=(s,t)=>{t.stopPropagation(),ze(s),W(L())},ce=s=>{s.track?Z(n,s.track.id):(g(s.query),k(s.type))};return e.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 glass-strong safe-top",children:e.jsx(K,{maxWidth:"full",children:e.jsxs("div",{className:"py-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{size:22,className:"text-primary"}),e.jsx("h1",{className:"text-xl lg:text-2xl font-bold",children:"Search"})]}),e.jsx(we,{})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:c==="song"?"default":"outline",size:"sm",onClick:()=>k("song"),className:"flex-1",children:[e.jsx(P,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Song / Artist"}),e.jsx("span",{className:"sm:hidden",children:"Song"})]}),e.jsxs(p,{variant:c==="chord"?"default":"outline",size:"sm",onClick:()=>k("chord"),className:"flex-1",children:[e.jsx(ee,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Chord Progression"}),e.jsx("span",{className:"sm:hidden",children:"Chords"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(ve,{placeholder:c==="song"?"Search songs or artists...":"e.g., vi-IV-I-V or I-V-vi-IV",value:r,onChange:s=>g(s.target.value),className:"pl-10 bg-muted/50",autoFocus:!0})]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>le(!O),className:"w-full",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Filters",(f.length>0||d!=="all"||m!=="all")&&e.jsx(N,{variant:"secondary",className:"ml-2",children:f.length+(d!=="all"?1:0)+(m!=="all"?1:0)})]}),e.jsx(Se,{children:O&&e.jsx(j.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Genre",f.length>0&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>C([]),className:"h-6 text-xs",children:"Clear"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["pop","rock","hip hop","r&b","jazz","funk","soul","blues","country","disco","synthpop","reggae","punk"].map(s=>e.jsx(N,{variant:f.includes(s)?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{C(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Energy"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All"},{value:"high",label:"High Energy"},{value:"medium",label:"Medium"},{value:"low",label:"Chill"}].map(s=>e.jsx(N,{variant:d===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>F(s.value),children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Mood"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All",icon:ge},{value:"happy",label:"Happy",icon:"ðŸ˜Š"},{value:"neutral",label:"Neutral",icon:"ðŸ˜"},{value:"sad",label:"Melancholic",icon:"ðŸ˜¢"}].map(s=>e.jsxs(N,{variant:m===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>R(s.value),children:[typeof s.icon=="string"?s.icon:""," ",s.label]},s.value))})]})]})})})]})})}),e.jsx("main",{className:"py-4 space-y-6",children:e.jsxs(K,{maxWidth:"full",children:[!r&&D.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Recent Searches"]}),e.jsx("div",{className:"space-y-2",children:D.slice(0,10).map((s,t)=>e.jsx(j.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.03},onClick:()=>ce(s),className:"p-3 glass rounded-lg cursor-pointer hover:bg-muted/50 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:s.type==="song"?e.jsx(P,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("div",{className:"flex-1 min-w-0",children:s.track?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium truncate",children:s.track.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.track.artist})]}):e.jsx("div",{className:"font-medium",children:s.query})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",onClick:a=>ne(s.id,a),children:e.jsx(B,{className:"w-4 h-4"})})]})},s.id))})]}),c==="chord"&&!r&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Popular Progressions"}),e.jsx("div",{className:"space-y-2",children:ye.slice(0,5).map((s,t)=>e.jsxs(j.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},onClick:()=>g(s.progression.join("-")),className:"w-full p-4 glass rounded-xl text-left group hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(_e,{className:"w-4 h-4 text-muted-foreground group-hover:text-foreground transition-colors"})]}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:s.progression.map((a,i)=>e.jsx(X,{chord:a,size:"sm"},i))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:s.description})]},s.name))})]}),r&&y.length===0&&v.length===0&&!S&&e.jsx("section",{children:e.jsxs("div",{className:"glass rounded-2xl p-8 text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mx-auto",children:e.jsx(se,{className:"w-10 h-10 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2",children:['No results for "',r,'"']}),f.length>0||d!=="all"||m!=="all"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"No tracks match your search with the selected filters"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>{C([]),F("all"),R("all")},children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Searched ",b.length," tracks with chord progressions"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Try searching for artist names like "weeknd" or chord progressions like "vi-IV-I-V"'})]})]}),!x&&e.jsxs("div",{className:"glass-strong rounded-xl p-6 space-y-3 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[#1DB954]",children:[e.jsx(Ie,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Unlock unlimited search"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect Spotify to search millions of songs beyond the local database"}),e.jsx(p,{onClick:()=>n("/profile"),className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white",size:"lg",children:"Connect Spotify"})]})]})}),(y.length>0||v.length>0)&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2 flex-wrap",children:["Results (",y.length+v.length,")",S&&e.jsx(je,{className:"w-3 h-3 animate-spin"}),y.length>0&&e.jsx("span",{className:"text-[#1DB954] text-xs",children:"via Spotify"}),v.length>0&&e.jsx("span",{className:"text-xs text-purple-500",children:"via Local DB"})]}),(f.length>0||d!=="all"||m!=="all")&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{C([]),F("all"),R("all")},className:"h-7 text-xs",children:"Clear Filters"})]}),(f.length>0||d!=="all"||m!=="all")&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[f.map(s=>e.jsxs(N,{variant:"secondary",className:"text-xs",children:[s,e.jsx(B,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>C(t=>t.filter(a=>a!==s))})]},s)),d!=="all"&&e.jsxs(N,{variant:"secondary",className:"text-xs",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),d," energy",e.jsx(B,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>F("all")})]}),m!=="all"&&e.jsxs(N,{variant:"secondary",className:"text-xs",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),m,e.jsx(B,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>R("all")})]})]}),e.jsxs("div",{className:"space-y-2",children:[y.map((s,t)=>e.jsx(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>V(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.album&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:s.album})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(H,{track:{spotifyId:s.spotify_id??s.id,youtubeId:s.youtube_id,urlSpotifyWeb:s.external_url},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"md"})})]})},s.id)),y.length<re&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx(p,{variant:"outline",size:"sm",onClick:oe,disabled:S,children:S?"Loadingâ€¦":"Load more Spotify results"})}),ie.map((s,t)=>e.jsx(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>V(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(H,{track:{youtubeId:s.youtube_id,spotifyId:s.spotify_id,urlYoutube:s.url_youtube},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"md"})})]})},s.id)),v.map((s,t)=>e.jsx(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.progression_roman&&e.jsx("div",{className:"flex gap-1 mt-2 flex-wrap",children:s.progression_roman.map((a,i)=>e.jsx(X,{chord:a,size:"sm",keySignature:s.detected_key},i))})]}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx(H,{track:{spotifyId:s.spotify_id,youtubeId:s.youtube_id,urlYoutube:s.url_youtube,urlSpotifyWeb:s.url_spotify_web},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"md",className:"justify-end"})})]})},s.id))]})]}),r&&y.length===0&&v.length===0&&!S&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-muted-foreground",children:['No results found for "',r,'"']}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:!x&&u?"Connect Spotify for full catalog access":"Try a different search term"})]}),!r&&c==="song"&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Trending Tracks"}),e.jsx("div",{className:"space-y-2",children:b.slice(0,10).map((s,t)=>e.jsx(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 text-lg font-bold text-muted-foreground",children:t+1}),s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx(H,{track:{spotifyId:s.spotify_id,youtubeId:s.youtube_id,urlYoutube:s.url_youtube,urlSpotifyWeb:s.url_spotify_web},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"sm"})]})},s.id))})]})]})}),e.jsx(Ne,{})]})}export{Je as default};
