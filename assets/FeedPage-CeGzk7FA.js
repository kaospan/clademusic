import{j as e,m as y,a as M,u as P,r as o,B as l,X as V,b as q,d as O,e as Q,C as Z,f as ee}from"./index-BYq2Unmc.js";import{T as se}from"./TrackCard-Dk5m5dMR.js";import{S as te}from"./ScrollingComments-DnTNtSUb.js";import{B as z}from"./BottomNav-DF3xNuSu.js";import{A as D}from"./index-BamsV0Ig.js";import{S as ae}from"./sparkles-C_R_kGH3.js";import{U as ie}from"./TrackComments-CcBbk0Kl.js";import{R as E}from"./ResponsiveLayout-B_1UTA10.js";import{u as ne}from"./useLastFm-2Mmk-iw8.js";import{C as re,P as oe}from"./ProfileCircle-BcOyP4KP.js";import{C as le}from"./circle-alert-CtHqqcSn.js";import{L as A}from"./log-in-D7Eihnkm.js";import"./ChordBadge-BagiFfMw.js";import"./rotate-ccw-DUMszhNt.js";import"./switch-euN-WGgb.js";import"./index-Cia8Cal0.js";import"./useFollowing-Dn3Lxay7.js";import"./label-C9Ud08nt.js";import"./users-Bfk9i75L.js";import"./map-pin-CHpS3sc-.js";import"./radio-CE0PUjxi.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-D7B3xrbQ.js";import"./check-CnLKGY9f.js";import"./twitter-p6r-xncH.js";import"./send-BOiGPMEh.js";import"./timeFormat-BXo_t6_Q.js";import"./user-B_lJdxIT.js";import"./music-2-BEFPndHG.js";import"./heart-LIt6MD5o.js";import"./waves-B-0-1olt.js";import"./bookmark-qQ2awxMs.js";import"./search-B5eaoMv3.js";import"./menu-BhGhsuW3.js";import"./textarea-C1mfO8Jv.js";import"./badge-DcUo1LG1.js";import"./index-BhCXTRpW.js";import"./chevron-right-C_6ZgIa8.js";import"./trash-2-DBOXMgbv.js";function ce(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(i=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${i*100}ms`}},i))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(i=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},i))})]})]})}function de(){const{guestMode:i,user:k}=M(),b=P(),[N,h]=o.useState(()=>{const w=localStorage.getItem("clade_guest_banner_dismissed");if(!w)return!1;const S=parseInt(w,10),F=24*60*60*1e3;return Date.now()-S<F}),f=i&&!k&&!N,p=()=>{h(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},C=()=>{b("/signup")};return e.jsx(D,{children:f&&e.jsxs(y.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(l,{size:"sm",onClick:C,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(l,{size:"sm",variant:"ghost",onClick:p,className:"text-muted-foreground hover:text-foreground",children:e.jsx(V,{className:"w-4 h-4"})})]})]})]})})}function Oe(){const{user:i,loading:k,guestMode:b,enterGuestMode:N}=M(),{data:h}=ne(),f=P(),{data:p,isLoading:C,error:w}=q(50),{data:S=[],isLoading:F}=O([],[],50),_=(p==null?void 0:p.tracks)??[],R=i?S:[],U=((h==null?void 0:h.recentTracks)??[]).map((s,t)=>{var a;return{id:`lastfm:${s.artist}-${s.name}-${((a=s.playedAt)==null?void 0:a.getTime())??t}`,title:s.name,artist:s.artist,album:s.album,cover_url:s.imageUrl}}),d=(()=>{const s=new Set;return[...U,..._,...R].filter(a=>{var m;const c=(a.title||a.name||"").toLowerCase().trim(),x=(a.artist||((m=a.artists)==null?void 0:m[0])||"").toLowerCase().trim(),r=a.spotify_id||a.youtube_id||`${c}|${x}`||a.id;return!r||s.has(r)?!1:(s.add(r),!0)})})(),[n,L]=o.useState(0),[Y,B]=o.useState(new Map),I=o.useRef(null),[X,g]=o.useState(!i),{openPlayer:$}=Q();o.useEffect(()=>{(i||b)&&g(!1)},[i,b]);const H=s=>{var a;if(!i){g(!0);return}const t=(a=d[n])==null?void 0:a.id;t&&(B(c=>{const x=new Map(c),r=new Set(c.get(t)||[]);return r.has(s)?r.delete(s):r.add(s),x.set(t,r),x}),s==="skip"&&n<d.length-1&&L(c=>c+1))},j=o.useCallback(()=>{n<d.length-1&&L(s=>s+1)},[n,d.length]),v=o.useCallback(()=>{n>0&&L(s=>s-1)},[n]);if(o.useEffect(()=>{const s=t=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||(t.key==="ArrowDown"||t.key==="j"?j():(t.key==="ArrowUp"||t.key==="k")&&v())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[j,v]),o.useEffect(()=>{const s=I.current;if(!s)return;let t=0,a=0,c=0;const x=m=>{t=m.touches[0].clientY,a=m.touches[0].clientX,c=Date.now()},r=m=>{const G=m.changedTouches[0].clientY,J=m.changedTouches[0].clientX,T=t-G,W=Math.abs(a-J),K=Date.now()-c;Math.abs(T)>50&&Math.abs(T)>W&&K<500&&(T>0?j():v())};return s.addEventListener("touchstart",x,{passive:!0}),s.addEventListener("touchend",r,{passive:!0}),()=>{s.removeEventListener("touchstart",x),s.removeEventListener("touchend",r)}},[j,v]),k||C||F)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ce,{}),e.jsx(z,{})]});if(w)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(le,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(z,{})]});const u=d[n];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:I,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(E,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{size:24,className:"text-primary"}),e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"})]}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[n+1," / ",d.length]}),!i&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>{N(),g(!1)},className:"gap-1.5",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Continue as guest"})]}),e.jsxs(l,{variant:"ghost",onClick:()=>f("/auth"),className:"gap-1.5",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]}),e.jsx(oe,{})]})]})})}),X&&!i&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Youâ€™re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",onClick:()=>f("/auth"),children:"Sign in"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>g(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(l,{variant:"outline",size:"icon",className:"glass",onClick:v,disabled:n===0,children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsx(l,{variant:"outline",size:"icon",className:"glass",onClick:j,disabled:n===d.length-1,children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsxs(E,{maxWidth:"full",className:"py-6",children:[!i&&e.jsx("div",{className:"mx-auto mb-4 max-w-lg lg:max-w-2xl rounded-lg border border-border/60 bg-background/70 px-4 py-3 shadow-md backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Continue as guest to browse using the latest Last.fm scrobbles. You can switch to your account anytime."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"secondary",onClick:()=>{N(),g(!1)},children:"Continue as guest"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>f("/auth"),children:"Sign in"})]})]})}),e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(D,{mode:"wait",children:u&&e.jsx(y.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx(se,{track:u,isActive:!0,onInteraction:H,interactions:Y.get(u.id)||new Set,onPipModeActivate:(s,t)=>{s&&$({canonicalTrackId:u.id,provider:"youtube",providerTrackId:s,autoplay:!0,context:"feed",title:t,artist:u.artist})}})},u.id)})})]})}),d[n]&&e.jsx(te,{roomId:"global",maxVisible:3,scrollSpeed:4e3}),e.jsx(de,{}),e.jsx(z,{})]})}export{Oe as default};
