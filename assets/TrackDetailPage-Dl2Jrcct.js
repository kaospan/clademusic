import{c as O,r as l,j as e,m as b,at as J,u as X,t as Z,e as ee,aW as se,o as te,B as I,Q as ae,x as S,P as D,q as A,_ as re}from"./index-BwokqWUm.js";import{B as ie}from"./BottomNav-B5kOPxuM.js";import{T as le}from"./TrackLineageView-Dm5VuJyW.js";import{T as oe}from"./TrackComments-CKZjgr3O.js";import{H as de}from"./heart-B5jS5Sbs.js";import{M as ne}from"./send-QHp_x90t.js";import{S as ce}from"./share-2-D1rKDAXO.js";import{S as me}from"./ScrollingComments-b16lmesT.js";import{C as h}from"./card-DFK4skjK.js";import{T as xe,a as ue,b as p,c as f}from"./tabs-BXZwNqi3.js";import{b as W,c as he}from"./timeFormat-1gw3rh39.js";import{C as pe,P as fe}from"./ProfileCircle-dNBGVNsB.js";import{M as P}from"./music-2-ClNhJJUA.js";import{A as ge}from"./arrow-left-D6-ecnKZ.js";import{E as je}from"./external-link-Bcn99mir.js";import"./menu-DOhLMPUF.js";import"./search-B_zF9Xl2.js";import"./user-ocqv7jmx.js";import"./badge-Bu_Wz6O5.js";import"./arrow-right-BvG7rpeg.js";import"./textarea-bEEHn9zx.js";import"./index-B91dYdHV.js";import"./chevron-right-CZf9s2k8.js";import"./check-T5eEYh5j.js";import"./index-DDWLPyMc.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./trash-2-CDupPpYW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=O("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function ye({trackId:o,likes:v=0,isLiked:s=!1,onLike:c,onComment:g,onShare:m}){const[d,x]=l.useState(s),[n,w]=l.useState(v),j=()=>{x(!d),w(d?n-1:n+1),c==null||c()};return e.jsxs("div",{className:"fixed right-3 top-1/2 -translate-y-1/2 z-40 flex flex-col gap-4 md:hidden transform",children:[e.jsxs(b.button,{whileTap:{scale:.9},onClick:j,className:"flex flex-col items-center gap-1","aria-label":d?"Unlike":"Like",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-background/80 backdrop-blur-xl border border-border/50 shadow-lg",children:e.jsx(de,{className:`h-6 w-6 transition-all ${d?"fill-red-500 text-red-500":"text-foreground"}`})}),n>0&&e.jsx("span",{className:"text-xs font-semibold text-foreground drop-shadow-lg",children:n>=1e3?`${(n/1e3).toFixed(1)}k`:n})]}),e.jsx(b.button,{whileTap:{scale:.9},onClick:g,className:"flex flex-col items-center gap-1","aria-label":"Comment",children:e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-background/80 backdrop-blur-xl border border-border/50 shadow-lg",children:e.jsx(ne,{className:"h-6 w-6 text-foreground"})})}),e.jsx(b.button,{whileTap:{scale:.9},onClick:m,className:"flex flex-col items-center gap-1","aria-label":"Share",children:e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-background/80 backdrop-blur-xl border border-border/50 shadow-lg",children:e.jsx(ce,{className:"h-6 w-6 text-foreground"})})})]})}const Ne=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,be=o=>!!(o&&Ne.test(o));function Xe(){const{trackId:o}=J(),v=X(),{data:s,isLoading:c}=Z(decodeURIComponent(o||"")),{openPlayer:g,provider:m,trackId:d,canonicalTrackId:x,positionMs:n,seekToMs:w}=ee(),j=l.useMemo(()=>s?!!(x&&s.id&&x===s.id||m==="spotify"&&s.spotify_id&&d===s.spotify_id||m==="youtube"&&s.youtube_id&&d===s.youtube_id):!1,[x,m,d,s]),k=j?Math.max(0,n):0,Y=s!=null&&s.id&&be(s.id)?s.id:void 0,_=se(Y),T=l.useMemo(()=>{const t=_.data;return Array.isArray(t)?[...t].sort((a,r)=>a.start_ms-r.start_ms):[]},[_.data]),[C,$]=l.useState(null),[ve,F]=l.useState(null),[L,H]=l.useState([]),[U,M]=l.useState(!1),i=T.find(t=>k>=t.start_ms&&k<t.end_ms),R=(()=>{if(!(i!=null&&i.chords)||!(i!=null&&i.chord_timings))return-1;const t=k-i.start_ms;for(let a=i.chord_timings.length-1;a>=0;a--)if(t>=i.chord_timings[a])return a;return 0})();l.useEffect(()=>{s!=null&&s.id&&(async()=>(await q(),await K(),await Q()))()},[s==null?void 0:s.id]);async function Q(){if(!(!(s!=null&&s.artist)||!(s!=null&&s.title))){M(!0);try{const a=(await te(s.artist,s.title)).map(r=>({id:r.videoId,videoId:r.videoId,title:r.title,type:r.type}));H(a)}catch(t){console.error("Failed to load YouTube videos:",t)}finally{M(!1)}}}async function q(){if(!(!(s!=null&&s.title)||!(s!=null&&s.artist)))try{s.progression_roman&&$({chords:s.progression_roman,key:s.detected_key,mode:s.detected_mode,source:"local"})}catch(t){console.error("Failed to load Hooktheory data:",t)}}async function K(){if(!(!(s!=null&&s.title)||!(s!=null&&s.artist)))try{F({samples:[],sampledBy:[],covers:[],source:"local"})}catch(t){console.error("Failed to load WhoSampled data:",t)}}function V(t){const a=Math.floor(t.start_ms/1e3);if(j){w(t.start_ms);return}if(!s)return;const r=re(),u=!!s.spotify_id,y=!!s.youtube_id,N=r==="spotify"&&u?"spotify":r==="youtube"&&y?"youtube":u?"spotify":y?"youtube":null,B=N==="spotify"?s.spotify_id??null:N==="youtube"?s.youtube_id??null:null;!N||!B||g({provider:N,providerTrackId:B,canonicalTrackId:s.id,autoplay:!0,startSec:a,context:"section_navigation",title:s.title,artist:s.artist})}function G(t){!(s!=null&&s.artist)||!(s!=null&&s.title)||g({canonicalTrackId:s.id,provider:"youtube",providerTrackId:t.videoId,autoplay:!0,context:"track-detail-video",title:s.title,artist:s.artist})}const z=L.length>0?L:s!=null&&s.youtube_id?[{id:"official",videoId:s.youtube_id,title:`${s.title} - Official`,type:"official"}]:[];return c||!s?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-12 h-12 text-muted-foreground animate-pulse mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading track..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 glass-strong safe-top",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 max-w-4xl mx-auto",children:[e.jsx(I,{variant:"ghost",size:"icon",onClick:()=>v(-1),children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx(pe,{size:22,className:"text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-bold truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx(fe,{})]})}),e.jsxs("main",{className:"px-4 py-6 max-w-4xl mx-auto space-y-6",children:[e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:s.title,className:"w-32 h-32 rounded-lg object-cover flex-shrink-0 shadow-lg"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.title}),e.jsx("p",{className:"text-lg text-muted-foreground",children:s.artist}),s.album&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.album})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[s.detected_key&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Key:"}),e.jsxs("span",{className:"font-medium",children:[s.detected_key," ",s.detected_mode]})]}),s.tempo&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-muted-foreground",children:"BPM:"}),e.jsx("span",{className:"font-medium",children:Math.round(s.tempo)})]}),s.genre&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-muted-foreground",children:"Genre:"}),e.jsx("span",{className:"font-medium capitalize",children:s.genre})]})]}),s.genres&&s.genres.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.genres.map((t,a)=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary",children:t},a))}),s.genre_description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.genre_description}),(s.songwriter||s.producer||s.label||s.release_date)&&e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 pt-2 border-t border-border/50",children:[s.songwriter&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Written by:"})," ",s.songwriter]}),s.producer&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Produced by:"})," ",s.producer]}),s.label&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Label:"})," ",s.label]}),s.release_date&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Released:"})," ",new Date(s.release_date).toLocaleDateString()]})]}),s.id&&e.jsx("div",{className:"pt-4 border-t border-border/50",children:e.jsx(le,{trackId:s.id})}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsx(ae,{track:{spotifyId:s.spotify_id,youtubeId:s.youtube_id},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"lg"})})]})]}),e.jsxs(xe,{defaultValue:"sections",className:"w-full",children:[e.jsxs(ue,{className:"w-full grid grid-cols-5",children:[e.jsx(p,{value:"sections",children:"Sections"}),e.jsx(p,{value:"chords",children:"Chords"}),e.jsx(p,{value:"samples",children:"Samples"}),e.jsx(p,{value:"videos",children:"Videos"}),e.jsx(p,{value:"comments",children:"Comments"})]}),e.jsx(f,{value:"sections",className:"space-y-3",children:e.jsxs(h,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Song Structure"}),_.isLoading?e.jsx("div",{className:"text-sm text-muted-foreground animate-pulse",children:"Loading section markers…"}):T.length===0?e.jsxs("div",{className:"flex items-start gap-2 rounded-lg border bg-muted/20 p-3 text-sm text-muted-foreground",children:[e.jsx(E,{className:"w-4 h-4 mt-0.5"}),e.jsx("div",{children:"Section markers aren’t available yet for this track."})]}):e.jsx("div",{className:"space-y-2",children:T.map(t=>{const a=(i==null?void 0:i.id)===t.id;return e.jsxs("button",{onClick:()=>V(t),className:S("w-full p-3 glass rounded-lg text-left transition-all group",a?"bg-primary/20 border-primary/50 shadow-lg":"hover:bg-muted/50"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:S("font-medium capitalize flex items-center gap-2",a&&"text-primary"),children:[t.label,a&&e.jsx("span",{className:"text-xs animate-pulse",children:"●"}),!a&&e.jsx(D,{className:"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[W(t.start_ms)," - ",W(t.end_ms)]})]}),e.jsxs("div",{className:"flex-shrink-0 ml-4 flex flex-col items-end",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:he(t.end_ms-t.start_ms)}),e.jsx("div",{className:"mt-2",children:e.jsx(I,{size:"sm",variant:"outline",onClick:r=>{r.stopPropagation(),V(t)},className:"text-xs h-8 px-3",children:"Play section"})})]})]}),t.chords&&t.chords.length>0&&e.jsx("div",{className:"flex gap-2 flex-wrap mt-2",children:t.chords.map((r,u)=>{const y=a&&R===u;return e.jsx(A,{chord:r,keySignature:s.detected_key,size:"lg",className:S("transition-all duration-200",y&&"ring-2 ring-primary scale-110 shadow-lg")},u)})})]},t.id)})})]})}),e.jsx(f,{value:"chords",className:"space-y-3",children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Chord Progression"}),(C==null?void 0:C.source)==="local"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Local data"})]}),s.progression_roman&&s.progression_roman.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2.5 flex-wrap",children:s.progression_roman.map((t,a)=>e.jsx(A,{chord:t,keySignature:s.detected_key,size:"lg"},a))}),s.detected_key&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Key: ",s.detected_key," ",s.detected_mode]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No chord data available"})]})}),e.jsx(f,{value:"samples",className:"space-y-3",children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Sample Connections"}),e.jsxs(I,{variant:"ghost",size:"sm",className:"h-7 text-xs",children:[e.jsx(je,{className:"w-3 h-3 mr-1"}),"WhoSampled"]})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No sample data available yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"WhoSampled integration coming soon"})]})]})}),e.jsx(f,{value:"videos",className:"space-y-3",children:e.jsxs(h,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Video Sources"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Click the Play button above to start playback. Video player continues across navigation."}),e.jsx("div",{className:"space-y-2",children:U?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2 animate-pulse"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Searching YouTube..."})]}):e.jsxs(e.Fragment,{children:[z.map(t=>e.jsxs("button",{onClick:()=>G(t),className:"w-full p-3 glass rounded-lg text-left hover:bg-muted/50 transition-colors flex items-center gap-3",children:[e.jsx(D,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t.title}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:t.type})]}),provider==="youtube"&&activeTrackId===t.videoId&&e.jsx("span",{className:"text-xs text-primary",children:"Playing"})]},t.id)),z.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No videos available"})]})]})})]})}),e.jsx(f,{value:"comments",className:"space-y-3",children:e.jsx(h,{className:"p-6",children:e.jsx(oe,{trackId:o||""})})})]})]}),e.jsx(ye,{trackId:o||"",likes:Math.floor(Math.random()*1e3),onComment:()=>{const t=document.querySelector('[value="comments"]');t==null||t.scrollIntoView({behavior:"smooth"})},onShare:()=>{navigator.share&&navigator.share({title:`${s.title} - ${s.artist}`,url:window.location.href})}}),e.jsx(me,{trackId:o,maxVisible:3,scrollSpeed:4e3}),e.jsx(ie,{})]})}export{Xe as default};
