import{j as e,m as w,a as D,u as A,r as n,B as r,X as V,b as $,C as q,d as O}from"./index-uVJjQOkW.js";import{T as Q}from"./TrackCard-BFtfqQK3.js";import{u as Z,S as ee}from"./useTracks-sDfPP9Ke.js";import{B as I}from"./BottomNav-BX9bmXn6.js";import{A as P}from"./index-DOEYlflL.js";import{S as se}from"./sparkles-DKiwjAdm.js";import{U as te}from"./TrackComments-CwMPsOEk.js";import{u as ae,R as E}from"./useSpotifyUser-suSUsiXi.js";import{C as ie}from"./circle-alert-BaMEznG7.js";import{L as M}from"./log-in-DVaa9w8T.js";import"./ChordBadge-CtOji3mJ.js";import"./rotate-ccw-BGKqhvaI.js";import"./avatar-oDley9zk.js";import"./switch-9B67tkDF.js";import"./index-XLfXIdiw.js";import"./useFollowing-DwJVigqE.js";import"./useMutation-WGDTCfqi.js";import"./label-BMtB-Bfd.js";import"./users-CoC1-sF0.js";import"./map-pin-A-sWbtDS.js";import"./radio-B4GRYG0O.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-BnvxD95S.js";import"./check-DXwTZNqJ.js";import"./twitter-PyqVaZo_.js";import"./send-BbyEklsc.js";import"./timeFormat-BXo_t6_Q.js";import"./music-2-C0Uh-_O1.js";import"./CladeIcon-o_Lowt9-.js";import"./heart-CNhJlcHI.js";import"./waves-CU_Uiygc.js";import"./bookmark-CmDtGFDl.js";import"./search-BusLwKyj.js";import"./seedTracks-B6rAh97_.js";import"./spotifySearchService-Cgu05vzP.js";import"./menu-DLPFzK5h.js";import"./textarea-CjWDxJW5.js";import"./badge-BfCmVe8S.js";import"./index-CVJFdOf3.js";import"./chevron-right-BrxrPjto.js";import"./trash-2-Bt8I4Zg5.js";function ne(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(a=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${a*100}ms`}},a))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},a))})]})]})}function re(){const{guestMode:a,user:y}=D(),v=A(),[b,x]=n.useState(()=>{const N=localStorage.getItem("clade_guest_banner_dismissed");if(!N)return!1;const C=parseInt(N,10),F=24*60*60*1e3;return Date.now()-C<F}),u=a&&!y&&!b,k=()=>{x(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},S=()=>{v("/signup")};return e.jsx(P,{children:u&&e.jsxs(w.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(r,{size:"sm",onClick:S,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(r,{size:"sm",variant:"ghost",onClick:k,className:"text-muted-foreground hover:text-foreground",children:e.jsx(V,{className:"w-4 h-4"})})]})]})]})})}function $e(){const{user:a,loading:y,guestMode:v,enterGuestMode:b}=D(),x=A(),{data:u,isLoading:k,error:S}=Z(50),{data:N=[],isLoading:C}=ae([],[],50),F=(u==null?void 0:u.tracks)??[],Y=a?N:[],_=[...F,...Y],l=(()=>{const s=new Set;return _.filter(t=>{const o=t.spotify_id||t.id;return!o||s.has(o)?!1:(s.add(o),!0)})})(),[i,T]=n.useState(0),[B,R]=n.useState(new Map),L=n.useRef(null),[U,h]=n.useState(!a),{openPlayer:X}=$();n.useEffect(()=>{(a||v)&&h(!1)},[a,v]);const H=s=>{var o;if(!a){h(!0);return}const t=(o=l[i])==null?void 0:o.id;t&&(R(c=>{const g=new Map(c),d=new Set(c.get(t)||[]);return d.has(s)?d.delete(s):d.add(s),g.set(t,d),g}),s==="skip"&&i<l.length-1&&T(c=>c+1))},p=n.useCallback(()=>{i<l.length-1&&T(s=>s+1)},[i,l.length]),f=n.useCallback(()=>{i>0&&T(s=>s-1)},[i]);if(n.useEffect(()=>{const s=t=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||(t.key==="ArrowDown"||t.key==="j"?p():(t.key==="ArrowUp"||t.key==="k")&&f())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[p,f]),n.useEffect(()=>{const s=L.current;if(!s)return;let t=0,o=0,c=0;const g=j=>{t=j.touches[0].clientY,o=j.touches[0].clientX,c=Date.now()},d=j=>{const G=j.changedTouches[0].clientY,J=j.changedTouches[0].clientX,z=t-G,W=Math.abs(o-J),K=Date.now()-c;Math.abs(z)>50&&Math.abs(z)>W&&K<500&&(z>0?p():f())};return s.addEventListener("touchstart",g,{passive:!0}),s.addEventListener("touchend",d,{passive:!0}),()=>{s.removeEventListener("touchstart",g),s.removeEventListener("touchend",d)}},[p,f]),y||k||C)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ne,{}),e.jsx(I,{})]});if(S)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(ie,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(I,{})]});const m=l[i];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:L,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(E,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[i+1," / ",l.length]}),!a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>{b(),h(!1)},className:"gap-1.5",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Continue as guest"})]}),e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>x("/auth"),className:"gap-1.5",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]})]})]})})}),U&&!a&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Youâ€™re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{size:"sm",onClick:()=>x("/auth"),children:"Sign in"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>h(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(r,{variant:"outline",size:"icon",className:"glass",onClick:f,disabled:i===0,children:e.jsx(q,{className:"w-5 h-5"})}),e.jsx(r,{variant:"outline",size:"icon",className:"glass",onClick:p,disabled:i===l.length-1,children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsxs(E,{maxWidth:"full",className:"py-6",children:[!a&&e.jsx("div",{className:"mx-auto mb-4 max-w-lg lg:max-w-2xl rounded-lg border border-border/60 bg-background/70 px-4 py-3 shadow-md backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Continue as guest to browse using the latest Last.fm scrobbles. You can switch to your account anytime."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{size:"sm",variant:"secondary",onClick:()=>{b(),h(!1)},children:"Continue as guest"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>x("/auth"),children:"Sign in"})]})]})}),e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(P,{mode:"wait",children:m&&e.jsx(w.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx(Q,{track:m,isActive:!0,onInteraction:H,interactions:B.get(m.id)||new Set,onPipModeActivate:(s,t)=>{s&&X({canonicalTrackId:m.id,provider:"youtube",providerTrackId:s,autoplay:!0,context:"feed",title:t,artist:m.artist})}})},m.id)})})]})}),l[i]&&e.jsx(ee,{roomId:"global",maxVisible:3,scrollSpeed:4e3}),e.jsx(re,{}),e.jsx(I,{})]})}export{$e as default};
