import{c as k,a as P,u as A,r as c,o as p,j as e,B as x,m as F}from"./index-FBrkeiAb.js";import{C as g}from"./card-CknsQ7Sg.js";import{C as M,P as $}from"./ProfileCircle-BOlyNdo1.js";import{I as B}from"./input-CTgd8Jv7.js";import{S as V,M as q}from"./search-DYzDnr7R.js";import{P as b}from"./plus-B-MvKoCj.js";import{T as w}from"./trending-up-Cq52odta.js";import{A as z,a as D}from"./arrow-up-9UoDEeYC.js";import{S as E}from"./share-2-Bp2KU4yb.js";import{B as I}from"./bookmark-BtXTNfgA.js";import"./user-4-WuAq6N.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=k("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),j=typeof import.meta<"u"&&!1||typeof process<"u"&&!1;function se(){const{user:t}=P(),n=A(),[l,o]=c.useState(""),[i,d]=c.useState("hot"),[m,u]=c.useState([]),[r,f]=c.useState([]),[v,N]=c.useState(!1);c.useEffect(()=>{j||(_(),h())},[]);const C=c.useMemo(()=>{if(!l.trim())return m;const s=l.toLowerCase();return m.filter(a=>a.name.toLowerCase().includes(s)||a.display_name.toLowerCase().includes(s)||(a.description||"").toLowerCase().includes(s))},[m,l]),y=c.useMemo(()=>{if(!l.trim())return r;const s=l.toLowerCase();return r.filter(a=>a.title.toLowerCase().includes(s)||(a.content||"").toLowerCase().includes(s)||a.forum.display_name.toLowerCase().includes(s)||a.forum.name.toLowerCase().includes(s)||(a.user.display_name||"").toLowerCase().includes(s)||(a.user.username||"").toLowerCase().includes(s))},[r,l]);async function _(){if(j)return;const{data:s}=await p.from("forums").select("*").order("member_count",{ascending:!1}).limit(10);s&&u(s)}async function h(){if(j)return;N(!0);let s=p.from("forum_posts").select(`
        *,
        user:profiles!user_id(username, display_name, avatar_url),
        forum:forums!forum_id(name, display_name)
      `);i==="hot"?s=s.order("vote_count",{ascending:!1}):i==="new"?s=s.order("created_at",{ascending:!1}):i==="top"&&(s=s.order("vote_count",{ascending:!1}));const{data:a}=await s.limit(50);a&&f(a),N(!1)}async function S(s,a){if(!t){n("/auth");return}const{error:L}=await p.from("forum_votes").upsert({user_id:t.id,post_id:s,vote_type:a});L||h()}return e.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur border-b border-border",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{size:24,className:"text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Forums"})]}),e.jsx("div",{className:"flex-1 max-w-2xl",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(B,{value:l,onChange:s=>o(s.target.value),placeholder:"Search forums and posts...",className:"pl-10"})]})}),e.jsxs(x,{onClick:()=>n("/forum/create-post"),children:[e.jsx(b,{className:"h-5 w-5 mr-2"}),"Create Post"]}),e.jsx($,{})]}),e.jsx("div",{className:"flex gap-2 mt-4",children:["hot","new","top"].map(s=>e.jsxs(x,{variant:i===s?"default":"ghost",size:"sm",onClick:()=>{d(s),h()},children:[s==="hot"&&e.jsx(w,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:s.charAt(0).toUpperCase()+s.slice(1)})]},s))})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:v?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent"})}):y.map(s=>e.jsx(H,{post:s,onVote:S,onClick:()=>n(`/forum/post/${s.id}`)},s.id))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(g,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Popular Forums"]}),e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsx(F.button,{whileHover:{x:4},onClick:()=>n(`/forum/${s.name}`),className:"w-full text-left p-3 rounded-lg hover:bg-accent transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:["f/",s.name]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.member_count.toLocaleString()," members"]})]}),e.jsx(x,{size:"sm",variant:"outline",children:"Join"})]})},s.id))})]}),e.jsxs(g,{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Create a Forum"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Build a community around your passion"}),e.jsxs(x,{className:"w-full",onClick:()=>n("/forum/create-forum"),children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Create Forum"]})]})]})]})})]})}function H({post:t,onVote:n,onClick:l}){const[o,i]=c.useState(t.vote_count),[d,m]=c.useState(t.user_vote||null),u=(r,f)=>{f.stopPropagation(),d===r?(m(null),i(o-(r==="up"?1:-1))):d?(m(r),i(o+(r==="up"?2:-2))):(m(r),i(o+(r==="up"?1:-1))),n(t.id,r)};return e.jsx(g,{className:"p-4 hover:border-border/80 transition-colors cursor-pointer",onClick:l,children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{onClick:r=>u("up",r),className:`p-1 rounded hover:bg-accent transition-colors ${d==="up"?"text-orange-500":"text-muted-foreground"}`,children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("span",{className:`text-sm font-bold ${d==="up"?"text-orange-500":d==="down"?"text-blue-500":"text-foreground"}`,children:o}),e.jsx("button",{onClick:r=>u("down",r),className:`p-1 rounded hover:bg-accent transition-colors ${d==="down"?"text-blue-500":"text-muted-foreground"}`,children:e.jsx(D,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[e.jsxs("span",{className:"font-semibold",children:["f/",t.forum.name]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Posted by u/",t.user.username]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:Q(t.created_at)})]}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:t.title}),t.content&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3 mb-3",children:t.content}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("button",{className:"flex items-center gap-1 hover:text-foreground transition-colors",children:[e.jsx(q,{className:"h-4 w-4"}),t.comment_count," comments"]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-foreground transition-colors",children:[e.jsx(U,{className:"h-4 w-4"}),"Award"]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-foreground transition-colors",children:[e.jsx(E,{className:"h-4 w-4"}),"Share"]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-foreground transition-colors",children:[e.jsx(I,{className:"h-4 w-4"}),"Save"]})]})]})]})})}function Q(t){const n=new Date(t),o=Math.floor((new Date().getTime()-n.getTime())/1e3);return o<60?"just now":o<3600?`${Math.floor(o/60)}m ago`:o<86400?`${Math.floor(o/3600)}h ago`:o<604800?`${Math.floor(o/86400)}d ago`:n.toLocaleDateString()}export{se as ForumHomePage};
